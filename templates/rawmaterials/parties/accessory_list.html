{# templates/rawmaterials/parties/accessory_list.html #}

<div class="d-flex justify-content-between align-items-center mb-2">
  <h5 class="mb-0">Accessories</h5>

  {% if show_controls|default:True %}
    <div class="d-flex gap-2">
      {% if can_create %}
        <a href="{% url 'rawmaterials:accessory_create' %}" class="btn btn-sm btn-primary">
          Add Accessory
        </a>
      {% endif %}

      <a href="{% url 'rawmaterials:accessory_download_csv' %}"
         class="btn btn-sm btn-outline-secondary">
        Download CSV
      </a>
    </div>
  {% endif %}
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover align-middle mb-0">
    <thead class="table-light">
      <tr>
        <th>Item Name</th>
        <th>Quality</th>
        <th>Base Color</th>
        <th>Type</th>
        <th>Width</th>
        <th>Use In</th>
        <th class="text-end">Stock</th>
        <th class="text-end">Cost / Unit</th>
        <th>Vendor</th>
        {% if can_edit or can_delete %}
          <th class="text-center">Actions</th>
        {% endif %}
      </tr>
    </thead>

    <tbody>
      {% for acc in accessories %}
        <tr>
          {# Item Name #}
          <td>{{ acc.item_name }}</td>

          {# Quality: prefer quality_text then quality (show raw string so textual values appear) #}
          <td>
            {% if acc.quality_text %}
              {{ acc.quality_text }}
            {% elif acc.quality %}
              {{ acc.quality }}
            {% else %}
              &mdash;
            {% endif %}
          </td>

          {# Base Color #}
          <td>{{ acc.base_color|default:"—" }}</td>

          {# Type (item_type) #}
          <td>{{ acc.item_type|default:"—" }}</td>

          {# Width (decimal) #}
          <td class="text-nowrap">
            {% if acc.width is not None %}
              {{ acc.width|floatformat:2 }}
            {% else %}
              &mdash;
            {% endif %}
          </td>

          {# Use In #}
          <td>{{ acc.use_in|default:"—" }}</td>

          {# Stock (right aligned, 3 decimals) #}
          <td class="text-end">
            {{ acc.stock|default_if_none:0|floatformat:3 }}
          </td>

          {# Cost per unit (right aligned, 2 decimals) #}
          <td class="text-end">
            {{ acc.cost_per_unit|default_if_none:0|floatformat:2 }}
          </td>

          {# Vendor: show vendor_name if present, else dash #}
          <td>
            {% if acc.vendor %}
              {{ acc.vendor.vendor_name }}
            {% else %}
              &mdash;
            {% endif %}
          </td>

          {# Actions (Edit / Delete) #}
          {% if can_edit or can_delete %}
            <td class="text-center">
              {% if can_edit %}
                <a href="{% url 'rawmaterials:accessory_edit' acc.pk %}"
                   class="btn btn-sm btn-outline-primary me-1">
                  Edit
                </a>
              {% endif %}

              {% if can_delete %}
                <form method="post"
                      action="{% url 'rawmaterials:inventory_delete' acc.pk %}"
                      style="display:inline-block;">
                  {% csrf_token %}
                  <button type="submit"
                          class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('Are you sure you want to delete this accessory? This action cannot be undone.');">
                    Delete
                  </button>
                </form>
              {% endif %}
            </td>
          {% endif %}
        </tr>
      {% empty %}
        <tr>
          <td colspan="{% if can_edit or can_delete %}10{% else %}9{% endif %}"
              class="text-center text-muted py-3">
            No accessories found.
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
